<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä HEMA SCHOOL - RECORDS DASHBOARD</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .download-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .download-section h2 {
            color: #667eea;
            font-size: 1.5em;
        }

        .download-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            font-weight: bold;
        }

        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .section-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        .section-header h2 {
            color: #667eea;
            font-size: 1.8em;
        }

        .record-count {
            background: #667eea;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
        }

        .table-wrapper {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
            white-space: nowrap;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9em;
        }

        tbody tr:hover {
            background: #f5f5ff;
        }

        tbody tr:nth-child(even) {
            background: #f9f9f9;
        }

        .empty-message {
            text-align: center;
            padding: 50px;
            color: #999;
            font-size: 1.2em;
        }

        .filter-section {
            background: #f5f5ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-section input,
        .filter-section select {
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            outline: none;
            transition: border-color 0.3s;
        }

        .filter-section input:focus,
        .filter-section select:focus {
            border-color: #764ba2;
        }

        .filter-btn {
            background: #667eea;
            color: white;
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }

        .filter-btn:hover {
            background: #764ba2;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .download-section {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üìä HEMA SCHOOL - RECORDS DASHBOARD</h1>
            <p><strong>Affiliated to: CENTRAL BOARD OF SECONDARY EDUCATION</strong></p>
            <p>School Code: 50383 | Affiliation No.: 1030417</p>
            <p>Govindpura, Bhopal, Madhya Pradesh, India - 462023</p>
            <p>üìß support@hemaschool.education | üìû 0755-2457270</p>
        </div>

        <!-- Download Section -->
        <div class="download-section">
            <div>
                <h2>üì• DOWNLOAD ALL DATA (EXCEL FILE)</h2>
                <p style="color: #666; margin-top: 5px;">Export all enquiries, registrations, and admissions to Excel/CSV format</p>
            </div>
            <button class="download-btn" onclick="downloadAllDataExcel()">
                üì• Download Complete Data
            </button>
        </div>

        <!-- Enquiry Records -->
        <div class="section-card">
            <div class="section-header">
                <h2>üìù ENQUIRY RECORDS</h2>
                <span class="record-count" id="enquiryCount">0 Records</span>
            </div>
            <div class="table-wrapper">
                <table id="enquiryTable">
                    <thead>
                        <tr>
                            <th>S.No</th>
                            <th>Date</th>
                            <th>Student Name</th>
                            <th>DOB</th>
                            <th>Gender</th>
                            <th>Class</th>
                            <th>Father Name</th>
                            <th>Father Mobile</th>
                            <th>Mother Name</th>
                            <th>Mother Mobile</th>
                            <th>Address</th>
                            <th>Area</th>
                            <th>City</th>
                            <th>District</th>
                            <th>State</th>
                            <th>Pincode</th>
                            <th>Source</th>
                        </tr>
                    </thead>
                    <tbody id="enquiryTableBody">
                        <tr><td colspan="17" class="empty-message">No enquiry records found</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Registration Records -->
        <div class="section-card">
            <div class="section-header">
                <h2>üìã REGISTRATION RECORDS</h2>
                <span class="record-count" id="registrationCount">0 Records</span>
            </div>
            <div class="table-wrapper">
                <table id="registrationTable">
                    <thead>
                        <tr>
                            <th>S.No</th>
                            <th>Date</th>
                            <th>Student Name</th>
                            <th>DOB</th>
                            <th>Gender</th>
                            <th>Class</th>
                            <th>Father Name</th>
                            <th>Father Mobile</th>
                            <th>Mother Name</th>
                            <th>Mother Mobile</th>
                            <th>Address</th>
                            <th>Area</th>
                            <th>State</th>
                            <th>Admission Fee</th>
                            <th>Total Fee</th>
                            <th>Signatory</th>
                        </tr>
                    </thead>
                    <tbody id="registrationTableBody">
                        <tr><td colspan="16" class="empty-message">No registration records found</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Admission Records -->
        <div class="section-card">
            <div class="section-header">
                <h2>üéì ADMISSION RECORDS</h2>
                <span class="record-count" id="admissionCount">0 Records</span>
            </div>
            <div class="table-wrapper">
                <table id="admissionTable">
                    <thead>
                        <tr>
                            <th>S.No</th>
                            <th>Admission Date</th>
                            <th>Scholar No</th>
                            <th>Student Name</th>
                            <th>DOB</th>
                            <th>Gender</th>
                            <th>Class</th>
                            <th>Section</th>
                            <th>House</th>
                            <th>Aadhaar</th>
                            <th>Father Name</th>
                            <th>Father Mobile</th>
                            <th>Mother Name</th>
                            <th>Mother Mobile</th>
                            <th>Address</th>
                            <th>Previous School</th>
                            <th>Category</th>
                        </tr>
                    </thead>
                    <tbody id="admissionTableBody">
                        <tr><td colspan="17" class="empty-message">No admission records found</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Load all data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadEnquiryData();
            loadRegistrationData();
            loadAdmissionData();
        });

        // Utility function to get data from localStorage
        function getLocalStorageData(keys) {
            let allData = [];
            keys.forEach(key => {
                try {
                    const data = localStorage.getItem(key);
                    if (data) {
                        const parsed = JSON.parse(data);
                        if (Array.isArray(parsed)) {
                            allData = allData.concat(parsed);
                        }
                    }
                } catch (e) {
                    console.error('Error parsing ' + key, e);
                }
            });
            return allData;
        }

        // Load Enquiry Data
        function loadEnquiryData() {
            const data = getLocalStorageData(['enquiryRecords', 'enquiries']);
            const tbody = document.getElementById('enquiryTableBody');
            const countSpan = document.getElementById('enquiryCount');
            
            tbody.innerHTML = '';
            countSpan.textContent = data.length + ' Records';
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="17" class="empty-message">No enquiry records found</td></tr>';
                return;
            }
            
            data.forEach((record, index) => {
                const row = tbody.insertRow();
                const studentName = [record.studentFirst, record.studentMiddle, record.studentSurname].filter(Boolean).join(' ');
                const fatherName = [record.fatherFirst, record.fatherMiddle, record.fatherSurname].filter(Boolean).join(' ');
                const motherName = [record.motherFirst, record.motherMiddle, record.motherSurname].filter(Boolean).join(' ');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${record.date || ''}</td>
                    <td>${studentName || ''}</td>
                    <td>${record.dob || ''}</td>
                    <td>${record.gender || ''}</td>
                    <td>${record.classApplied || ''}</td>
                    <td>${fatherName || ''}</td>
                    <td>${record.fatherMobile || ''}</td>
                    <td>${motherName || ''}</td>
                    <td>${record.motherMobile || ''}</td>
                    <td>${record.address || ''}</td>
                    <td>${record.area || ''}</td>
                    <td>${record.city || ''}</td>
                    <td>${record.district || ''}</td>
                    <td>${record.state || ''}</td>
                    <td>${record.pincode || ''}</td>
                    <td>${record.source || ''}</td>
                `;
            });
        }

        // Load Registration Data
        function loadRegistrationData() {
            const data = getLocalStorageData(['registrationRecords', 'registrations']);
            const tbody = document.getElementById('registrationTableBody');
            const countSpan = document.getElementById('registrationCount');
            
            tbody.innerHTML = '';
            countSpan.textContent = data.length + ' Records';
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="16" class="empty-message">No registration records found</td></tr>';
                return;
            }
            
            data.forEach((record, index) => {
                const row = tbody.insertRow();
                const studentName = [record.studentFirst, record.studentMiddle, record.studentSurname].filter(Boolean).join(' ');
                const fatherName = [record.fatherFirst, record.fatherMiddle, record.fatherSurname].filter(Boolean).join(' ');
                const motherName = [record.motherFirst, record.motherMiddle, record.motherSurname].filter(Boolean).join(' ');
                const gender = record.genderMale ? 'Male' : (record.genderFemale ? 'Female' : '');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${record.date || ''}</td>
                    <td>${studentName || ''}</td>
                    <td>${record.dob || ''}</td>
                    <td>${gender}</td>
                    <td>${record.classApplied || ''}</td>
                    <td>${fatherName || ''}</td>
                    <td>${record.fatherMobile || ''}</td>
                    <td>${motherName || ''}</td>
                    <td>${record.motherMobile || ''}</td>
                    <td>${record.address || ''}</td>
                    <td>${record.area || ''}</td>
                    <td>${record.state || ''}</td>
                    <td>${record.feeAdmission || ''}</td>
                    <td>${record.totalFee || ''}</td>
                    <td>${record.signatoryName || ''}</td>
                `;
            });
        }

        // Load Admission Data
        function loadAdmissionData() {
            const data = getLocalStorageData(['admissionRecords', 'admissions']);
            const tbody = document.getElementById('admissionTableBody');
            const countSpan = document.getElementById('admissionCount');
            
            tbody.innerHTML = '';
            countSpan.textContent = data.length + ' Records';
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="17" class="empty-message">No admission records found</td></tr>';
                return;
            }
            
            data.forEach((record, index) => {
                const row = tbody.insertRow();
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${record.admissionDate || ''}</td>
                    <td>${record.scholarNo || ''}</td>
                    <td>${record.studentName || ''}</td>
                    <td>${record.dob || ''}</td>
                    <td>${record.gender || ''}</td>
                    <td>${record.class || ''}</td>
                    <td>${record.section || ''}</td>
                    <td>${record.house || ''}</td>
                    <td>${record.aadhaarNo || ''}</td>
                    <td>${record.fatherName || ''}</td>
                    <td>${record.fatherMobile || ''}</td>
                    <td>${record.motherName || ''}</td>
                    <td>${record.motherMobile || ''}</td>
                    <td>${record.address || ''}</td>
                    <td>${record.prevSchool || ''}</td>
                    <td>${record.category || ''}</td>
                `;
            });
        }

        // Download All Data to Excel/CSV
        function downloadAllDataExcel() {
            const enquiryData = getLocalStorageData(['enquiryRecords', 'enquiries']);
            const registrationData = getLocalStorageData(['registrationRecords', 'registrations']);
            const admissionData = getLocalStorageData(['admissionRecords', 'admissions']);
            
            let csv = '';
            
            // Enquiry Records - ALL FIELDS
            if (enquiryData.length > 0) {
                csv += '"ENQUIRY RECORDS"\n';
                csv += '"S.No","Date","Student First","Student Middle","Student Surname","DOB","Gender","Class Applied","Father First","Father Middle","Father Surname","Father Mobile","Mother First","Mother Middle","Mother Surname","Mother Mobile","Landline","Address","Area","City","District","State","Country","Pincode","Source","Referred Type","Referred Name","Sibling Discount","Sib1 Name","Sib1 Class","Sib1 Section","Sib1 School","Sib2 Name","Sib2 Class","Sib2 Section","Sib2 School"\n';
                
                enquiryData.forEach((record, index) => {
                    const row = [
                        index + 1,
                        record.date || '',
                        record.studentFirst || '',
                        record.studentMiddle || '',
                        record.studentSurname || '',
                        record.dob || '',
                        record.gender || '',
                        record.classApplied || '',
                        record.fatherFirst || '',
                        record.fatherMiddle || '',
                        record.fatherSurname || '',
                        record.fatherMobile || '',
                        record.motherFirst || '',
                        record.motherMiddle || '',
                        record.motherSurname || '',
                        record.motherMobile || '',
                        record.landline || '',
                        record.address || '',
                        record.area || '',
                        record.city || '',
                        record.district || '',
                        record.state || '',
                        record.country || '',
                        record.pincode || '',
                        record.source || '',
                        record.referredType || '',
                        record.referredName || '',
                        record.siblingDiscount || '',
                        record.sib1Name || '',
                        record.sib1Class || '',
                        record.sib1Section || '',
                        record.sib1School || '',
                        record.sib2Name || '',
                        record.sib2Class || '',
                        record.sib2Section || '',
                        record.sib2School || ''
                    ].map(field => `"${String(field).replace(/"/g, '""')}"`);
                    
                    csv += row.join(',') + '\n';
                });
                csv += '\n\n';
            }
            
            // Registration Records - ALL FIELDS
            if (registrationData.length > 0) {
                csv += '"REGISTRATION RECORDS"\n';
                csv += '"S.No","Date","Student First","Student Middle","Student Surname","DOB","Gender","Class Applied","Father First","Father Middle","Father Surname","Father Mobile","Mother First","Mother Middle","Mother Surname","Mother Mobile","Landline","Address","Area","State","Admission Fee","Caution Fee","Development Fee","Total Fee","Signatory Name","Sib1 Name","Sib1 Class/Sec","Sib1 School","Sib2 Name","Sib2 Class/Sec","Sib2 School"\n';
                
                registrationData.forEach((record, index) => {
                    const gender = record.genderMale ? 'Male' : (record.genderFemale ? 'Female' : '');
                    const row = [
                        index + 1,
                        record.date || '',
                        record.studentFirst || '',
                        record.studentMiddle || '',
                        record.studentSurname || '',
                        record.dob || '',
                        gender,
                        record.classApplied || '',
                        record.fatherFirst || '',
                        record.fatherMiddle || '',
                        record.fatherSurname || '',
                        record.fatherMobile || '',
                        record.motherFirst || '',
                        record.motherMiddle || '',
                        record.motherSurname || '',
                        record.motherMobile || '',
                        record.landline || '',
                        record.address || '',
                        record.area || '',
                        record.state || '',
                        record.feeAdmission || '',
                        record.feeCaution || '',
                        record.feeDevelopment || '',
                        record.totalFee || '',
                        record.signatoryName || '',
                        record.sib1Name || '',
                        record.sib1ClassSec || '',
                        record.sib1School || '',
                        record.sib2Name || '',
                        record.sib2ClassSec || '',
                        record.sib2School || ''
                    ].map(field => `"${String(field).replace(/"/g, '""')}"`);
                    
                    csv += row.join(',') + '\n';
                });
                csv += '\n\n';
            }
            
            // Admission Records - ALL FIELDS
            if (admissionData.length > 0) {
                csv += '"ADMISSION RECORDS"\n';
                csv += '"S.No","Admission Date","Scholar No","Student Name","DOB","DOB in Words","Current Age","Gender","Class","Section","House","Nationality","Religion","Category","Aadhaar No","APAAR ID","SSSM ID","PEN No","Family ID","Father Name","Father Mobile","Father Aadhaar","Father Qualification","Father Occupation","Mother Name","Mother Mobile","Mother Aadhaar","Mother Qualification","Mother Occupation","Guardian Name","Guardian Mobile","Guardian Aadhaar","Guardian Qualification","Guardian Occupation","Address","Previous School","Previous Class","Previous Affiliation","Last Session","TC No","TC Date","DOB Cert No","Caste Cert No","Admission Category","Bank Name","Bank Branch","Bank Account No","IFSC Code","Account Type","Account Holder","Sib1 Name","Sib1 Class/Sec","Sib1 School","Sib2 Name","Sib2 Class/Sec","Sib2 School","Declaration Name","Signatory Name","Signature Date","Signature Place"\n';
                
                admissionData.forEach((record, index) => {
                    const row = [
                        index + 1,
                        record.admissionDate || '',
                        record.scholarNo || '',
                        record.studentName || '',
                        record.dob || '',
                        record.dobWords || '',
                        record.currentAge || '',
                        record.gender || '',
                        record.class || '',
                        record.section || '',
                        record.house || '',
                        record.nationality || '',
                        record.religion || '',
                        record.category || '',
                        record.aadhaarNo || '',
                        record.apaarId || '',
                        record.sssmId || '',
                        record.penNo || '',
                        record.familyId || '',
                        record.fatherName || '',
                        record.fatherMobile || '',
                        record.fatherAadhaar || '',
                        record.fatherQual || '',
                        record.fatherOcc || '',
                        record.motherName || '',
                        record.motherMobile || '',
                        record.motherAadhaar || '',
                        record.motherQual || '',
                        record.motherOcc || '',
                        record.guardianName || '',
                        record.guardianMobile || '',
                        record.guardianAadhaar || '',
                        record.guardianQual || '',
                        record.guardianOcc || '',
                        record.address || '',
                        record.prevSchool || '',
                        record.prevClass || '',
                        record.prevAffiliated || '',
                        record.lastSession || '',
                        record.tcNo || '',
                        record.tcDate || '',
                        record.dobCertNo || '',
                        record.casteCertNo || '',
                        record.admissionCategory || '',
                        record.bankName || '',
                        record.bankBranch || '',
                        record.bankAccountNo || '',
                        record.ifscCode || '',
                        record.accountType || '',
                        record.bankHolderName || '',
                        record.sib1Name || '',
                        record.sib1ClassSec || '',
                        record.sib1School || '',
                        record.sib2Name || '',
                        record.sib2ClassSec || '',
                        record.sib2School || '',
                        record.declarationName || '',
                        record.signatoryName || '',
                        record.signatureDate || '',
                        record.signaturePlace || ''
                    ].map(field => `"${String(field).replace(/"/g, '""')}"`);
                    
                    csv += row.join(',') + '\n';
                });
            }
            
            if (!csv.trim()) {
                alert('No data available to download!');
                return;
            }
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'HEMA_School_Complete_Records_' + new Date().toISOString().split('T')[0] + '.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Data exported successfully!');
        }
    </script>
</body>
</html>
